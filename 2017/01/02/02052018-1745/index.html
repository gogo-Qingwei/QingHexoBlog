<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>basic sql and advanced sql notes | Qing&#39;s Journey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="test,test2" />
  
  
  
  
  <meta name="description" content="SQL SyntaxDATABASE: Database is a collection of data stored in some organized fashion.DATABASE MANAGEMENT SYSTEM(DBMS): Database software, we manipulate data vi">
<meta name="keywords" content="SQL,Database">
<meta property="og:type" content="article">
<meta property="og:title" content="Basic SQL and Advanced SQL Notes">
<meta property="og:url" content="http://yoursite.com/2017/01/02/02052018-1745/index.html">
<meta property="og:site_name" content="Qing&#39;s Journey">
<meta property="og:description" content="SQL SyntaxDATABASE: Database is a collection of data stored in some organized fashion.DATABASE MANAGEMENT SYSTEM(DBMS): Database software, we manipulate data via DBMS.TABLE: Table is a structured file">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-02-11T19:07:02.881Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Basic SQL and Advanced SQL Notes">
<meta name="twitter:description" content="SQL SyntaxDATABASE: Database is a collection of data stored in some organized fashion.DATABASE MANAGEMENT SYSTEM(DBMS): Database software, we manipulate data via DBMS.TABLE: Table is a structured file">
  
    <link rel="alternate" href="/atom.xml" title="Qing&#39;s Journey" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-02052018-1745" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Basic SQL and Advanced SQL Notes
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/01/02/02052018-1745/" class="article-date">
	  <time datetime="2017-01-02T20:00:00.000Z" itemprop="datePublished">2017-01-02</time>
	</a>

      
    <a class="article-category-link" href="/categories/SQL/">SQL</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="SQL-Syntax"><a href="#SQL-Syntax" class="headerlink" title="SQL Syntax"></a>SQL Syntax</h4><p><strong>DATABASE</strong>: Database is a collection of data stored in some organized fashion.<br><strong>DATABASE MANAGEMENT SYSTEM(DBMS)</strong>: Database software, we manipulate data via DBMS.<br><strong>TABLE</strong>: Table is a structured file that store data for a specific type. The table name is always unique - meaning no other table in that database can have the same name.<br><strong>Schema</strong>: Information about database and table layout and properties.<br><strong>Column</strong>: Tables are made up of columns.  Each column in a database has an associated data type.<br><strong>Data type</strong>:   a type of allowed data. Data types restrict the type of data that can be stored in a column.<br><strong>Row</strong>:   Data in a table is stored in rows.<br><strong>Primary Key</strong>:   A column(or columns) whose values uniquely identify every row in a table. No null values</p>
<p>[ROW - Select Row]<br>How to use the SQL SELECT statement to retrieve a single table columns.<br>Multiple SQL statements must be separated by semicolons<br>SQL statements are case-insensitive, while the names of tables, columns and values are not.<br>All extra white space within a SQL Statement is ignored when that statement is processed.<br>Select one column Select column_name<br>  From Products;<br>Select multiple columns Select column_name1,column_name2,column_name3<br>  From Products;<br>Select  all columns SELECT  *<br>  FROM Products;<br>Select distinct rows  SELECT DISTINCT column_name<br>  FROM Products;<br>Select limit results  SELECT<br>      column1,column2,…<br>  FROM<br>      table<br>  LIMIT offset , count;</p>
<p>  Select  column_name<br>  From Products<br>  where<br>  Limit 5 offset 5;<br>  //return 5 rows starting from row 5</p>
<p>  Or<br>  Select  column_name<br>  From Products<br>  Where<br>  Limit OFFSETNUM,LIMITNUM;<br>  //limit后面不可以跟表达式<br>Set comments  –  or  # or /<em> </em>/</p>
<p>[ROW - Order By]<br>How to use the SELECT statement’s ORDER BY clause to sort retrieved data<br>ORDER BY clause is the last clause in your SELECT statement. (put it at the end)<br>ASC = Ascending order(default), DESC=Descending order<br>Using FIELD() function to define your own custom sort order, not ASC or DESC<br>Sorting data  Select column_name<br>  From Products<br>  Order by column_name<br>Sorting by multiple columns Select column_name1,column_name2,column_name3<br>  From Products<br>  Order by column_name2,column_name3<br>  OR<br>  Select column_name1,column_name2,column_name3<br>  From Products<br>  Order by 2,3<br>Sorting different direction Select column_name1,column_name2,column_name3<br>  From Products<br>  Order by 2 DESC, 3 ASC;<br>Sorting by custom order select orderNumber,status<br>  from orders<br>  order by FIELD(status,<br>  ‘In Process’,<br>  ‘On Hold’,<br>  ‘Cancelled’,<br>  ‘Resolved’,<br>  ‘Disputed’,</p>
<h2 id="‘Shipped’"><a href="#‘Shipped’" class="headerlink" title="  ‘Shipped’);"></a>  ‘Shipped’);</h2><p>  SELECT<br>      CONCAT(prefix, suffix)<br>  FROM<br>      items<br>  ORDER BY prefix , suffix;</p>
<p>[ROW - Search Conditions]<br>How to specify search conditions<br>If we want to extract subset of the table’s data as needed for specific operations or reports.<br>The single quotes are used to delimit a string.<br>WHERE is used not only with the SELECT but also DELETE and UPDATE<br>Select special items  SELECT column_name1,column_name2<br>  FROM Products<br>  WHERE column_name1 = number;<br>Check for no value  SELECT  column_name<br>  FROM Customers<br>  WHERE column _name IS NULL;<br>= Equal<br>&lt;&gt;  Not equal. Note: In some versions of SQL this operator may be written as != </p>
<blockquote>
<p>Greater than<br>&lt; Less than<br>=  Greater than or equal<br>&lt;=  Less than or equal<br>BETWEEN Between an inclusive range (range)  SELECT * FROM employee_tbl<br>  expr [NOT] BETWEEN begin_expr AND end_expr; WHERE daily_typing_pages BETWEEN 170 AND 300;<br>LIKE  Search for a pattern/   LIKE ‘%$_20%’ ESCAPE ‘$’; or LIKE ‘%\$_20%’ TO escape character<br>IN  To specify multiple possible values for a column  SELECT firstname, city, state<br>    FROM customers<br>    WHERE state IN (‘Arizona’, ‘Washington’, ‘Oklahoma’, ‘Colorado’, ‘Hawaii’);<br>IS NULL To test whether a value is NULL or not  </p>
</blockquote>
<p>[Boolean]<br>How to use the NOT and IN operators?<br>If we want to extract subset of the table’s data as needed for specific operations or reports.<br>The single quotes are used to delimit a string.<br>The IN operator is the same as OR<br>IN takes a comma-delimited list of valid values, all enclosed within parentheses<br>Using the AND(RANK HIGHER)  SELECT column_name1,column_name2<br>  FROM Products<br>  WHERE column_name1 = number1 AND column_name2 = number2;<br>Using the OR  SELECT column_name1,column_name2<br>  FROM Products<br>  WHERE column_name1 = number1 OR column_name2 = number2;<br>Using the IN  SELECT column_name1,column_name2<br>        • Far cleaner and easier to read  FROM Products<br>        • Easier to manage  WHERE column_name1 IN (val1,val2)<br>        • Can contain another SELECT<br>Using the NOT SELECT column_name1,column_name2<br>        • Used before the column to filter on FROM Products<br>  WHERE column_name1 NOT IN (val1,val2)</p>
<p>  #IN operator can contain another SELECT Statement<br>Using the Exist SELECT employeenumber, firstname, lastname, extension<br>  FROM employees<br>  WHERE exists(<br>  SELECT 1<br>  FROM offices<br>  WHERE city = ‘San Francisco’ and offices.officeCode = employees.officeCode);</p>
<p>[ROW - Like and Wildcard]<br>How to perform wildcard searches?-LIKE<br>How to create search pattern to compare against your data?<br>% represents zero, one, or more characters at the specified location in the search pattern<br> don’t overuse wildcats for processing takes long time<br> Percent sign(%)  SELECT column_name<br>        • Match any number of occurrences of any character  FROM Products<br>  WHERE column_name<br>  LIKE ‘Fish%’ // accept any characters after the word ‘Fish’</p>
<p>  SELECT column_name<br>  FROM Products<br>  WHERE column_name<br>  LIKE ‘%Fish%’ // accept any characters before or after the word ‘Fish’</p>
<p>  SELECT column_name<br>  FROM Products<br>  WHERE column<em>name<br>  LIKE ‘F%i’ // accept any products that begin with F and end with a i<br> Underscore(</em>)  SELECT  column_name<br>        • Just like %, but just a single character matching.  FROM Customers<br>  WHERE column <em>name LIKE ‘</em> inch’<br> Brackets([]) SELECT  column_name<br>        • Used to specify a set of characters FROM Customers<br>  WHERE  column_name LIKE ‘[JM]%’<br>  ORDER BY  column_name;// start with J or M</p>
<p>[ROW - Aliases and Concat columns]<br>How to use aliases to refer to fields?<br>How to create fields?<br>What calculated fields are?<br>Aliases can be used when you create a calculated field, renaming a column if the real table column name contains illegal characters, or changing the ambiguous name.<br> Concatenate  // use concat<br>        • Joining values together to form a single long value. Join column and column SELECT concat(vend_name, ‘ (‘ , vend_country ,’)’)<br>  FROM Vendors<br>  ORDER BY vend_name;</p>
<p>Trim the padding space<br>        • RTRIM() trims all space from the right of a value<br>        • LTRIM() trim all the left side of a string<br>        • TRIM() trims both the right and left<br>Using aliases SELECT  column_name AS aliases<br>  FROM Customers<br>  WHERE column_name IS NULL;<br>SQL Mathematical operators  +addition<br>  -Subtraction<br>  *Multiplication<br>  /Division</p>
<p>[ROW - Mathematic Functions]<br>What types of function DBMSs support?<br>How to use these functions?<br>Very few functions are supported identically by all major DBMSs.<br>We can functions in other parts of the SELECT statement, as well as in other SQL statements.<br>Text manipulation functions SELECT column_name1,UPPER(column_name2)<br>          // convert text to upper case</p>
<p>  SELECT column_name1,column_name2<br>  FROM Customers<br>  WHERE SOUNDEX(column_name1) = soundex(‘name’);<br>  // SOUNDEX takes into account similar sounding characters and syllables, enabling strings to be compared by how they sound rather than how they have been typed.</p>
<p>Date and time manipulation functions  SELECT order_num<br>  FROM Orders<br>  WHERE year(order_date) = 2012;// in MySQL and MariaDB<br>Numeric manipulation functions  </p>
<p>[Lesson Eight - Aggregate Functions]<br>How to use SQL aggregate functions to summarize table data<br>These functions enable you to perform all the types of retrieval just enumerated<br>All ignore NULL values<br> Aggregate functions  </p>
<p>[Lesson Nine - Group By and having]<br>Introduce the GROUP BY clause and the HAVING clause<br>You can perform aggregate calculations on each group.<br>GROUP BY clause must come after any WHERE clause and before any ORDER BY clause<br>SELECT<br>    c1, c2,…, cn, aggregate_function(ci)<br>FROM<br>    table<br>WHERE<br>    where_conditions<br>GROUP BY c1 , c2,…,cn;<br>DIFF: HAVING AND WHERE  HAVING is very similar to WHERE. The only difference is that WHERE filters rows and HAVING filters groups.</p>
<p>  SELECT vend_id, COUNT(<em>) AS num_prods<br>  FROM Products<br>  WHERE prod_price &gt;= 4<br>  GROUP BY vend_id<br>  HAVING COUNT(</em>) &gt;= 2;<br>DIFF: ORDER BY &amp; GROUP BY As a rule, anytime you use a GROUP BY clause, you should also specify an ORDER BY clause. That is the only way to ensure that data will be sorted properly. Never rely on GROUP BY to sort your data.<br>Conclusion  </p>
<p>[ROW - Subqueries]<br>What subqueries are?<br>How to use subqueries?<br>Subqueries are queries that are embedded into other queries.<br>Subqueries is nested inside another query such as SELECT, INSERT, UPDATE, DELETE.</p>
<p> Subqueries select cust_name, cust_state,<br>  (SELECT COUNT(*)<br>   FROM Orders<br>   WHERE Orders.cust_id = Customers.cust_id) AS orders<br>   FROM Customers<br>   ORDER BY cust_name;</p>
<p>[TABLE - join/self-join/inner/outer/]<br>The key here is that having multiple occurrences of the same data is never a good thing, and that principle is the basis for relational database design. The tables are related to each other through common values.<br>A well-designed database or application is said to scale well.<br>If we want to retrieve data in multiple tables with a single SELECT statement, Use JOIN<br>JOIN clause is not a physical entity, and is created by the DBMS as needed.<br>Creating a join SELECT vend_name, prod_name, prod_price<br>  FROM Vendors,Products<br>  WHERE Vendors.vend_id = Products.vend_id;  //use this to inner join<br>Cartesian product The results returned by a table relationship without a join condition. The number of rows retrieved will be the number of rows in the first table multiplied by the number of rows in the second table. Sometimes you’ll hear the type of join that returns a Cartesian Product referred to as a cross join.<br>  SELECT column_name(s)<br>  FROM table1<br>  INNER JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  or:<br>  SELECT column_name(s)<br>  FROM table1<br>  JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  SELECT column_name(s)<br>  FROM table1<br>  LEFT JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  or:<br>  SELECT column_name(s)<br>  FROM table1<br>  LEFT OUTER JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  SELECT column_name(s)<br>  FROM table1<br>  RIGHT JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  or:<br>  SELECT column_name(s)<br>  FROM table1<br>  RIGHT OUTER JOIN table2<br>  ON table1.column_name=table2.column_name;<br>  NOT SUPPORT IN MYSQL  </p>
<p>SELF JOIN SELECT a.column_name, b.column_name…<br>  FROM table1 a, table1 b<br>  WHERE a.common_field = b.common_field;<br>CROSS JOIN  SELECT<br>      *<br>  FROM<br>      T1<br>          CROSS JOIN<br>      T2;</p>
<p>[ROW- Union/Intersect]<br>How to use the UNION operator to combine multiple SELECT statements into one result set.<br>The combined queries are usually known as unions or compound queries.<br>Each query in a UNION must contain<br>The INTERSECT operator is a set operator that returns only distinct rows of two queries.<br>Using union SELECT cust_name, cust_contact, cust_email<br>  FROM Customers<br>  WHERE cust_state IN (‘IL’,’IN’,’MI’)<br>  UNION<br>  SELECT cust_name, cust_contact, cust_email<br>  FROM Customers<br>  WHERE CUST_NAME = ‘fUN4All’;<br>  Equal to<br>  SELECT cust_name, cust_contact, cust_email<br>  FROM Customers<br>  WHERE cust_state IN (‘IL’,’IN’,’MI’) OR CUST_NAME = ‘fUN4All’;<br> Using union all  SELECT City FROM Customers<br>        • Don’t eliminate duplicates  UNION ALL<br>  SELECT City FROM Suppliers<br>  ORDER BY City;<br>Using Intersect (SELECT column_list<br>        • The order and the number of columns must be the same. FROM table_1)<br>        • The data types of the corresponding columns must be compatible. INTERSECT<br>  (SELECT column_list<br>  FROM table_2);<br>Intersect = DISTINCT + INNER JOIN SELECT DISTINCT id FROM t1<br>  INNER JOIN t2 USING(id);<br>INTERSECT=DISTINCT + IN SELECT DISTINCT id FROM t1 WHERE id IN (SELECT id FROM )</p>
<p>[ROW- Insert Update/Delete a Row]<br>Inserting a single complete row<br>Inserting a single partial row<br>Inserting the results of a query<br>To update specific rows in a table<br>To update all rows in a table<br>To delete specific rows in a table<br>To delete all rows in a table<br>If you omit the WHERE clause, the UPDATE statement will update all rows in the table.<br>Inserting a single complete row insert into “tablename”<br>   (first_column,…last_column)<br>  VALUES (first_value,…last_value);<br>Inserting a single partial row  INSERT INTO Customers (CustomerName, City, Country)<br>  VALUES (‘Cardinal’, ‘Stavanger’, ‘Norway’);<br>Insert + Select SELECT *<br>  FROM TASKS;</p>
<p>  CREATE TABLE tasks_1 like tasks;</p>
<p>  Insert into tasks_1<br>  select <em><br>  from tasks;<br>Update a column UPDATE [LOW_PRIORITY] [IGNORE] table_name<br>  SET<br>      column_name1 = expr1,<br>      column_name2 = expr2,<br>      …<br>  WHERE<br>      condition;<br>Using UPDATE with INNER JOIN|LEFT JOIN, just change employees.  UPDATE employees<br>          LEFT JOIN<br>      merits ON employees.performance = merits.performance<br>  SET<br>      salary = salary + salary </em> 0.015<br>  WHERE<br>      merits.percentage IS NULL;<br> Delete a row DELETE FROM table   </p>
<h2 id="WHERE-conditions-ORDER-BY-…-LIMIT-rows"><a href="#WHERE-conditions-ORDER-BY-…-LIMIT-rows" class="headerlink" title="  [WHERE conditions] [ORDER BY …] [LIMIT rows]"></a>  [WHERE conditions] [ORDER BY …] [LIMIT rows]</h2><p>  delete from “tablename”</p>
<p>  where “columnname”<br>  OPERATOR “value”<br>  [and|or “column”<br>  OPERATOR “value”];<br>Delete data from multiple tables  DELETE table_1, table_2,…<br>  FROM table-refs<br>  [WHERE conditions]</p>
<p>  DELETE FROM table_1, table_2,…<br>  USING table-refs</p>
<h2 id="WHERE-conditions"><a href="#WHERE-conditions" class="headerlink" title="  [WHERE conditions]"></a>  [WHERE conditions]</h2><p>Using DELETE with INNER JOIN|LEFT JOIN, just change employees.  DELETE offices, employees<br>  FROM offices<br>  INNER JOIN employees<br>        ON employees.officeCode = employees.officeCode<br>  WHERE offices.officeCode = 5</p>
<h2 id="Now-you-can-delete-records-associated-with-officeCode-5-from-both-offices-and-employees-tables"><a href="#Now-you-can-delete-records-associated-with-officeCode-5-from-both-offices-and-employees-tables" class="headerlink" title="  //Now, you can delete records associated with officeCode 5 from both offices and employees tables:"></a>  //Now, you can delete records associated with officeCode 5 from both offices and employees tables:</h2><p>  DELETE T1<br>  FROM T1<br>  LEFT JOIN T2 ON T1.key = T2.key<br>  WHERE T2.key IS NULL</p>
<p>[TABLE - Alter or Create or Drop table]<br>The difference between ALTER and CREATE TABLE.<br>CREATE TABLE tableName [LIKE] anothertableName  CREATE TABLE customers_archive LIKE customers;</p>
<p>  INSERT INTO customers_archive<br>  SELECT * FROM customers<br>Drop a table(not delete a row): The drop table command is used to delete a table and all rows in the table. drop table “tablename”<br>Difference between drop and delete  Deleting all of the records in the table leaves the table including column and constraint information. Dropping the table removes the table definition as well as all of its rows.<br>Alter: is very useful when you want to change a name of your table, any table field or if you want to add or delete an existing column in table ALTER TABLE testalter_tbl DROP i;<br>  ALTER TABLE testalter_tbl ADD i INT FIRST;<br>  ALTER TABLE testalter_tbl MODIFY c CHAR(10);</p>
<p>[TABLE - Create Constraints]<br>An index can be created in a table to find data more quickly and efficiently.<br>Efficiently checking in a middle size<br>create constraint 1 CREATE UNIQUE INDEX index_name<br>  ON table_name (column_name)<br>create constraint 2 SQL  ALTER TABLE + ADD/DROP CONSTRAINT Syntax<br>Create Primary key: CREATE TABLE tableName(<br>        • A primary key column cannot contain NULL values. It means that you have to declare the primary key column with the NOT NULL  attribute. PRIMARY KEY(columnName),<br>        • A table has only one primary key. FOREIGN KEY(columnName) REFERENCES tableName(columnName),<br>        • A table can have multiple foreign  key  FOREIGN KEY(columnName) REFERENCES tableName(columnName)<br>  );<br>Add Primary key:  ALTER TABLE tableNameADD PRIMARY KEY(columnName)<br>Other constraints:<br>ALTER TABLE table_name<br>CHANGE old_column_name new_column_name new_column_definition;</p>
<p>ALTER TABLE table_name<br>ADD COLUMN columnName type AFTER othercolumnName</p>
<p>ALTER TABLE table_name<br>ADD FOREIGN KEY columnName REFERENCES table(columnName)</p>
<p>ALTER TABLE table_name<br>DROP CONSTRAINT constraint_name;</p>
<p>ALTER TABLE table_name<br>DROP FOREIGN KEY column_name</p>
<p>[TABLE - Alter Table]<br>Set default for a new table<br>Alter a default for an original table<br>New table :   CREATE TABLE IF NOT EXISTS tasks (<br>CREATE TABLE [IF NOT EXISTS] tableName(   task_id INT(11) NOT NULL AUTO_INCREMENT,<br>Column_list) engine = table_type;   subject VARCHAR(45) DEFAULT NULL,<br>//InnoDB, MyISAM, HEAP, EXAMPLE, CSV, ARCHIVE, MERGE FEDERATED or NDBCLUSTER    start_date DATE DEFAULT NULL,<br>    end_date DATE DEFAULT NULL,<br>    description VARCHAR(200) DEFAULT NULL,<br>    PRIMARY KEY (task_id)<br>  ) ENGINE=InnoDB<br>Other functions about ALTER: 只针对column进行变化。 ALTER TABLE tasks<br>  CHANGE COLUMN task_id task_id INT(11) not null auto_increment;</p>
<p>  select *<br>  from tasks;</p>
<p>  ALTER TABLE tasks<br>  ADD COLUMN complete DECIMAL(2,1) null<br>  AFTER start_date;</p>
<p>  ALTER TABLE tasks<br>  DROP COLUMN complete;</p>
<p>  ALTER TABLE tasks<br>  RENAME TO work_items;</p>
<p>  ALTER TABLE task<br>  ADD CONSTRAINT constraintName</p>
<p>[TABLE - Truncate Table]<br>is used to remove all records from a table in SQL server. It perform the same function as a DELETE without a WHERE<br>If you are using InnoDB tables, MySQL will check if there are any foreign key constraints available in the tables before deleting data. The following are cases:<br>  • If the table has any foreign key constraints, the TRUNCATE TABLE statement deletes rows one by one. If the foreign key constraint has DELETE CASCADE action, the corresponding rows in the child tables are also deleted.<br>  • If the foreign key constraint does not specify the DELETE CASCADE action, the TRUNCATE TABLE deletes rows one by one, and it will stop and issue an error when it encounters a row that is referenced by a row in a child table.<br>  • If the table does not have any foreign key constraint, the TRUNCATE TABLEstatement drops the table and recreates a new empty one with the same structure, which is faster and more efficient than using the DELETE statement especially for big tables.<br>If you are using other storage engines, the TRUNCATE TABLE statement just drops and recreates a new table.<br>Notice that the TRUNCATE TABLE statement resets auto increment value to zero if the table has an AUTO_INCREMENT column.<br>In addition, the TRUNCATE TABLE statement does not use the DELETE statement, therefore, the DELETE triggers associated with the table will not be invoked.</p>
<p>Truncate table  TRUNCATE TABLE [database_name.] [schema_name.] table_name<br>  [ WITH ( PARTITIONS ( partition_number<br>                      | partition_number TO partition_number ) ] ;<br>Truncate table and delete table TRUNCATE TABLE tableName;<br>[the difference between this two is that DELETE can roll back if you choose, but TRUNCATE will not] Equal to<br>  DELETE FROM tableName;</p>
<p>[TABLE - REPLACE Table - not usual]<br>If the new row already does not exist, the MySQL REPLACE  statement inserts a new row.<br>If the new row already exist, the REPLACE  statement deletes the old row first and then inserts a new row. In some cases, the REPLACE statement updates the existing row only.<br>Using replace   REPLACE INTO cities(id,population)<br>  VALUES(2,3696820);<br>  The REPLACE statement first inserts the new row into the cities table with the information provided by the column list. The insertion fails because the row with id 2 already exists in the cities table, therefore, MySQL raises a duplicate-key error.<br>  The REPLACE statement then updates the row that has the key specified in the value of the id column. In the normal process, it would delete the old row with conflict id first and then inserts a new row.<br>Replace and Insert  REPLACE INTO table_name(column_list)<br>  VALUES(value_list);<br>  INSERT INTO table_name(column_list)<br>  VALUES(value_list);<br>  If the column that has the NOT NULL attr and does not have a default value, and you don’t specify the value in the REPLACE, MYSQL will raise an error<br>Replace and Update  REPLACE INTO table</p>
<h2 id="SET-column"><a href="#SET-column" class="headerlink" title="  SET column"></a>  SET column</h2><p>  replace into citites<br>  set id = 4, name = ‘Phoenix’, population = 1768980;</p>
<p>  update citites<br>  set id = 4, name = ‘Phoenix’, population = 1768980;//raise error</p>
<p>[SQL ADVANCE - Additional Aggregate Functions]<br>Function  Description<br>AVG() Returns the average value<br>COUNT() Returns the number of rows<br>FIRST() Returns the first value<br>LAST()  Returns the last value<br>MAX() Returns the largest value<br>MIN() Returns the smallest value<br>ROUND() Rounds a numeric field to the number of decimals specified<br>SUM() Returns the sum<br>SQL String Functions<br>Function  Description<br>CHARINDEX Searches an expression in a string expression and returns its starting position if found<br>CONCAT()<br>LEFT()<br>LEN() / LENGTH()  Returns the length of the value in a text field<br>LOWER() / LCASE() Converts character data to lower case<br>LTRIM()<br>SUBSTRING() / MID() Extract characters from a text field<br>PATINDEX()<br>REPLACE()<br>RIGHT()<br>RTRIM()<br>UPPER() / UCASE() Converts character data to upper case<br>MySQL Date Functions<br>Function  Description<br>NOW() Returns the current date and time<br>CURDATE() Returns the current date<br>CURTIME() Returns the current time<br>DATE()  Extracts the date part of a date or date/time expression<br>EXTRACT() Returns a single part of a date/time  SELECT EXTRACT(YEAR FROM OrderDate) AS OrderYear,<br>    EXTRACT(MONTH FROM OrderDate) AS OrderMonth,<br>    EXTRACT(DAY FROM OrderDate) AS OrderDay<br>    FROM Orders<br>    WHERE OrderId=1<br>DATE_ADD()  Adds a specified time interval to a date<br>DATE_SUB()  Subtracts a specified time interval from a date<br>DATEDIFF()  Returns the number of days between two dates<br>DATE_FORMAT() Displays date/time data in different formats<br>SQL Server Date Functions<br>Function    Description<br>GETDATE()   Returns the current date and time<br>DATEPART()    Returns a single part of a date/time  SELECT DATEPART(yyyy,OrderDate) AS OrderYear,<br>    DATEPART(mm,OrderDate) AS OrderMonth,<br>    DATEPART(dd,OrderDate) AS OrderDay<br>    FROM Orders<br>    WHERE OrderId=1<br>DATEADD()   Adds or subtracts a specified time interval from a date<br>DATEDIFF()    Returns the time between two dates<br>CONVERT()   Displays date/time data in different formats<br>MySQL comes with the following data types for storing a date or a date/time value in the database:<br>  • DATE - format YYYY-MM-DD<br>  • DATETIME - format: YYYY-MM-DD HH:MI:SS<br>  • TIMESTAMP - format: YYYY-MM-DD HH:MI:SS<br>  • YEAR - format YYYY or YY</p>
<p>[SQL ADVANCE - MySQL Transactions - Not Usually ]<br>Source: <a href="https://www.tutorialspoint.com/mysql/mysql-transactions.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/mysql/mysql-transactions.htm</a><br>MySQL enables you to execute a set of MySQL operations to ensure that the database never contains the result of partial operation. If one of them fails, the rollback occurs to restore the database. If no error occurred, the entire set of statements is committed to the database. JUST IN INNODB<br>The difference between MyISAM and InnoDB:<br>The main difference are support for “referential integrity” and “transactions”<br>  MyISAM  InnoDB<br>构成上的区别： Stores its tables, data and indexes in diskspace using sparate 3 different files(.FRM, .MYD, .MYI)  Tables and indexes in a tablespace，一般为 2GB<br>事务处理上方面:  Faster than InnoDB, designed for need of speed/ no foreign keys/ no transaction, no commit and rollback Enforce foreign key constraints, or support transactions<br>SELECT UPDATE,INSERT，Delete操 作  Good for a lot of SELECT Statements.  1.如果你的数据执行大量的INSERT或UPDATE，出于性能方面的考虑，应该使用InnoDB表<br>    2.DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的 删除。<br>    3.LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性（例如外键）的表不适用<br>对AUTO_INCREMENT的 操作 每表一个AUTO_INCREMEN列的内部处理。  如果你为一个表指定AUTO_INCREMENT列，在数据词典里的InnoDB表句柄包含一个名为自动增长计数 器的计数器，它被用在为该列赋新值。<br>  MyISAM为INSERT和UPDATE操 作自动更新这一列。这使得AUTO_INCREMENT列更快（至少10%）。在序列顶的值被删除之后就不 能再利用。(当AUTO_INCREMENT列被定义为多列索引的最后一列， 可以出现重使用从序列顶部删除的值的情况）。 自动增长计数 器仅被存储在主内存中，而不是存在磁盘上<br>  AUTO_INCREMENT值可用ALTER TABLE或myisamch来重置  关于该计算器 的算法实现，请参考<br>  对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但 是在MyISAM表中，可以和其他字段一起建立联 合索引 AUTO_INCREMENT列 在InnoDB里 如何工作<br>  更好和更快的auto_increment处理<br>表 的具体行数 select count(<em>) from table,MyISAM只要简单的读出保存好的行数，注意的是，当count(</em>)语句包含 where条件时，两种表的操作是一样的 InnoDB 中不 保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行<br>lock  A DML statement will obtain an exclusive lock, no other session perform a SELECT or a DML operation on the table(table-level locking) locking on row level)<br>​    </p>
<p>Properties of Transactions: </p>
<pre><code>1. Atomicity: ensure all operations within the work unit are completed. 
2. Consistency: ensure the database properly changes states
3. Isolation: ensure transactions to operate independently and transparent to each other
4. Durability: ensure the result persists in case of a system failure commit and rollback (for different databases): 
5. Commit command should be issued if the transaction is completed(need commit to update)
6. If a failure occurs, a rollback command should be issued to return in the transaction to its previous state.(if any operation within the transaction fails, the entire transaction will fail. For atomicity)
</code></pre><p>  There are some statements cannot use within a transaction.<br>  CREATE / ALTER / DROP DATABASE<br>  CREATE / ALTER / DROP / RENAME / TRUNCATE TABLE<br>  CREATE / DROP INDEX<br>  CREATE / DROP EVENT<br>  CREATE / DROP FUNCTION<br>  CREATE / DROP PROCEDURE<br>  …<br>  MySQL automatically commits the changes to the database by default. 可以防止在删除时大错误的发生,常在商务级应用中使用。<br>  Table locking:  for preventing other sessions from accessing the table during a specific period. A client can acquire or release table locks only for itself.<br>  Sessions is different clients.<br>  Acquire a lock  LOCK TABLES table_name [READ | WRITE]</p>
<p>Release a lock  UNLOCK TABLES;<br>Table locking for read: can be acquired by multiple sessions at the same time; other sessions can not write antil the read is release; MySQL will release all the locks implicitly.   SELECT connection_id();<br>  SHOW processlist;</p>
<p>[SQL ADVANCE - Prepared Statement]</p>
<p>To make your queries execute faster and more secure. </p>
<ol>
<li>Use the prepare statement to prepare a statement for execution. Question mark is a placeholder for the productCode.  #prepared statement <a href="http://www.mysqltutorial.org/mysql-prepared-statement.aspx" target="_blank" rel="noopener">http://www.mysqltutorial.org/mysql-prepared-statement.aspx</a></li>
<li>Declare a produceCode variable and set it values to ‘S10_1678’ </li>
<li><p>Use DEALLOCATE PREPARE to release PREPARE statement.   prepare stmt1 from ‘SELECT productCode, productName</p>
<pre><code>   FROM products
   WHERE productCode=?&apos;;
set @pc=&apos;S10_1678&apos;;
execute stmt1 USING @pc;
</code></pre><p>DEALLOCATE PREPARE stmt1;</p>
</li>
</ol>
<p>[SQL ADVANCE - triggers - not usually]<br>A set of SQL statements stored in the database catalog. And is executed whenever an event associated with a table occurs. (a special type of stored procedure). The main difference between a trigger and a stored procedure is that a trigger is called automatically when a data modification event is made whereas a store procedure must be called explicitly.<br>Advantages<br>  • SQL triggers provide an alternative way to check the integrity of data.<br>  • SQL triggers can catch errors in business logic in the database layer.<br>  • SQL triggers provide an alternative way to run scheduled tasks. By using SQL triggers, you don’t have to wait to run the scheduled tasks because the triggers are invoked  automatically before or after a change  is made to the data in the tables.<br>  • SQL triggers are very useful to audit the changes of data in tables.<br>Disadvantages<br>  • SQL triggers only can provide an extended validation and they cannot replace all the validations. Some simple validations have to be done in the application layer. For example, you can validate user’s inputs in the client side by using JavaScript or in the server side using server-side scripting languages such as JSP, PHP, ASP.NET, Perl, etc.<br>  • SQL triggers are invoked and executed invisible from the client applications, therefore, it is difficult to figure out what happen in the database layer.<br>  • SQL triggers may increase the overhead of the database server.</p>
<p>Important words in SQL triggers:<br>BEFORE INSERT – activated before data is inserted into the table.<br>AFTER INSERT – activated after data is inserted into the table.<br>BEFORE UPDATE – activated before data in the table is updated.<br>AFTER UPDATE – activated after data in the table is updated.<br>BEFORE DELETE – activated before data is removed from the table.<br>AFTER DELETE – activated after data is removed from the table.<br>Triggers storage:<br>MySQL stores triggers in a data directory e.g., /data/classicmodels/ with the files named tablename.TRG and triggername.TRN :<br>The tablename.TRG file maps the trigger to the corresponding table.<br>the triggername.TRN file contains the trigger definition.<br>LIMITATIONS(CANNOT DO):<br>• Use SHOW, LOAD DATA, LOAD TABLE, BACKUP DATABASE, RESTORE, FLUSH and RETURN statements.<br>• Use statements that commit or rollback implicitly or explicitly such as COMMIT , ROLLBACK , START TRANSACTION , LOCK/UNLOCK TABLES , ALTER , CREATE , DROP ,  RENAME , etc.<br>• Use prepared statements such as PREPARE, EXECUTE, etc.<br>• Use dynamic SQL statements. </p>
<p>Syntax:<br>CREATE TRIGGER trigger_name<br>trigger_time trigger_event<br>ON table_name<br>FOR EACH ROW<br>BEGIN<br>…<br>END;<br>Drop triggers:<br>DROP TIGGER table_name.trigger_name;</p>
<p>[TABLE - VIEWS] like Excel<br>• It is a logic table, which  contains no value but have table structure, you can query data against it.<br>​<br>• Database system stores database views as a SQL SELECT statement with joins. When the data of the tables changes, the view reflects that changes.<br>• THE View is in SHOW TABLES results. Use SHOW FULL TABLE </p>
<p>Advantages  Syntax:<br>• ALLOW you to simplify complex queries. You can hide complexity of underlying tables to the end-users  CREATE<br>• Helps limit data access to specific users. To expose non-sensitive data to specific group of users.      [ALGORITHM = {MERGE  | TEMPTABLE | UNDEFINED}]<br>• Provides extra security layer. Can create read-only view  VIEW [database_name].[view_name]<br>• Enables computed columns  AS<br>• Enable backward compatibility.  [SELECT  statement]</p>
<p>Disadvantages<br>• Querying data from a database view can be slow, especially the view is created based on other views<br>• Tables dependency: you create a view based on underlying tables</p>
<p>[TABLE - Stored Procedures]<br>A stored procedure can be invoked by triggers.<br>Major Diff: A Function can be used in the SQL Queries while a procedure cannot be used in SQL queries </p>
<p>Advantages<br>• Increase the performance of the applications. Stored procedures are compiled and stored in the database. If an application uses a stored procedure multiple times in a single connection, the compiled version is used, or the stored procedure works like a query.<br>• Help reduce the traffic between application and database server.<br>• Can reusable and transparent to any application.<br>• Are secure. The database administrator can grant appropriate permissions to applications that access stored procedures</p>
<p>Disadvantages<br>• If you use a lot of stored procedures, the memory usage of every connection will increase substantially<br>• constructs of stored procedures make it more difficult to develop stored procedures<br>• Difficult to debug stored procedures<br>• Not easy to develop and maintain stored procedures.</p>
<p>Examples:<br>Create procedure  – stored procedure<br>  delimiter //<br>  – not related to the sp syntax. change the ; to //, we avoid mysql tool interpret<br>  – at a time and pass the sp to the server as a whole. // at the end indicates the end<br>  – of the stored procedure.<br>  create procedure GetAllProducts()<br>  – name of procedure is GetAllProducts<br>          begin<br>      – begin and end is the body of the stored procedure<br>      select * from products;<br>      end//<br>  delimiter ;<br>Call procedure  CALL STORED_PROCEDURE_NAME();<br>Declare variable  DECLARE variable_name datatype(size) DEFAULT default_value;<br>Parameters  IN[DEFAULT]/ OUT/ INOUTDEFINE A PARAMETER: MODE param_name param_type(param_size)</p>
<p>[SQL - IF ]</p>
<p>Syntax:<br>IF expression THEN<br>   statements;<br>END IF;</p>
<p>Syntax:<br>IF expression THEN<br>   statements;<br>ELSE<br>   else-statements;<br>END IF;</p>
<p>Syntax:<br>IF expression THEN<br>   statements;<br>ELSEIF elseif-expression THEN<br>   elseif-statements;<br>…<br>ELSE<br>   else-statements;<br>END IF;</p>
<p>Syntax:<br>CASE WHEN [condition] THEN result<br>[WHEN [condition]<br>THEN result …]<br>[ELSE result]<br>END</p>
<p>SELECT CASE 1 WHEN 1 THEN ‘this is case one’<br>WHEN 2 THEN ‘this is case two’<br>ELSE ‘this is not in the case’<br>END as ‘how to execute case statement’;    </p>
<p>[SQL - Important MySQL Function]<br>Source:<br>FIELD<br>CAST like str()/int(): convert a value of any type into a value(BINARY, CHAR, DATE, DATETIME, TIME, DECIMAL, SIGNED, UNSIGNED)<br>IFNULL() : IFNULL(expression_1,expression_2); The IFNULL function returns expression_1 if expression_1 is not NULL ; otherwise, it returns expression_2.<br>RAND():generates a random value for each row in the table.<br>select *<br>from employees<br>where jobtitle = ‘Sales Rep’<br>ORDER BY RAND()<br>LIMIT 1;<br>NOW()/ CURDATE()/CURTIME()<br>DATE_ADD(date, interval number type)<br>GROUP_CONCAT():<br>If you do not specify a separator, the GROUP_CONCAT function uses a comma (,) as the default separator.<br>SELECT<br>    GROUP_CONCAT(DISTINCT v<br>        ORDER BY v ASC<br>        SEPARATOR ‘;’)<br>FROM<br>    t;<br>SELECT user();<br>SELECT SESSION_USER();<br>SELECT system_user();<br>SELECT VERSION();</p>
<p>[ALL PROBLEMS ABOUT SQL]<br>  Constraint name:<br>  • NOT NULL - Indicates that a column cannot store NULL value<br>  • UNIQUE - Ensures that each row for a column must have a unique value<br>  • PRIMARY KEY - A combination of a NOT NULL and UNIQUE. Ensures that a column (or combination of two or more columns) have a unique identity which helps to find a particular record in a table more easily and quickly<br>  • FOREIGN KEY - Ensure the referential integrity of the data in one table to match values in another table<br>  • CHECK - Ensures that the value in a column meets a specific condition<br>  • DEFAULT - Specifies a default value for a column: ALTER column_name SET DEFAULT  ‘value’<br>  CREATE TABLE Orders<br>  (<br>  O_Id int NOT NULL,<br>  OrderNo int NOT NULL,<br>  P_Id int,<br>  PRIMARY KEY (O_Id),<br>  FOREIGN KEY (P_Id) REFERENCES Persons(P_Id)<br>  )</p>
<p>  THE CONS OF ASTERISK:<br>  • The asterisk return data from the columns produces unnecessary I/O disk and network traffic between the server and application.<br>  • Expose many sensitive information to unauthorized users. </p>
<p>  Distinct and Group By:<br>  • The Group by behaves like the distinct clause.<br>  • Group By clause sorts the result set whereas the Distinct clause does not.<br>  • Group By = DISTINCT + ORDER BY</p>
<p>How many ways to define a variable?</p>
<pre><code>1. User-defined variables(prefixed with @), if you refer to a variable that has not been inialized, it has a value of null
  SELECT @variable_1 := 1, @variable_2 := 10;Or
    SET @variable_1 = 1, @variable_2 = 10;
    User variables can be assigned a value from integer, decimal, floating-point, binary, string or NULL.
2. Local variables(no prefix), using DECLARE before accessing it.  The scope of a local variable is the BEGIN…END block within which is declared: 
  DELIMITER //
</code></pre><p>  CREATE PROCEDURE sp_test(var1 INT)<br>  BEGIN<br>      DECLARE start  INT unsigned DEFAULT 1;<br>      DECLARE finish INT unsigned DEFAULT 10;</p>
<pre><code>SELECT  var1, start, finish;

SELECT * FROM places WHERE place BETWEEN start AND finish; 
</code></pre><p>  END; //</p>
<p>  DELIMITER ;</p>
<pre><code>3. Server system variable(prefixed with @@),default value includes GLOBAL, SESSION or BOTH. 
  -- Syntax to Set value to a Global variable:
    SET GLOBAL sort_buffer_size=1000000;
    SET @@global.sort_buffer_size=1000000;
    -- Syntax to Set value to a Session variable:
    SET sort_buffer_size=1000000;
    SET SESSION sort_buffer_size=1000000;
    SET @@sort_buffer_size=1000000;
    SET @@local.sort_buffer_size=10000;
</code></pre><p>The difference between EXISTS And IN in SQL?<br>  (SOURCE: <a href="http://www.mysqltutorial.org/mysql-exists/" target="_blank" rel="noopener">http://www.mysqltutorial.org/mysql-exists/</a>)<br>  • EXISTS works based on the “at least found” principle, it returns true and stops scanning table once at least one mathcing row found.<br>  • IN operator is combined with a subquery, and MYSQL will process the subquery firsts and uses the result of the subquery to process the whole query.<br>  • EXISTS is much faster than IN, when the sub-query results is very large.<br>  • IN is faster than EXISTS, when the sub-query results is very small.<br>  SELECT<br>      customerNumber, customerName<br>  FROM<br>      customers<br>  WHERE<br>      customerNumber IN (SELECT<br>              customerNumber<br>          FROM<br>              orders);</p>
<p>  SELECT<br>          customerNumber, customerName<br>  FROM<br>          Customers<br>  WHERE<br>          EXIST(SELECT 1<br>                  FROM orders<br>                  WHERE orders.customernumber =<br>                  Customers.customernumber)<br>  SELECT <em><br>  FROM Customers<br>  WHERE EXISTS (<br>      SELECT </em><br>      FROM Orders<br>      WHERE Orders.CustomerID = Customers.ID<br>  )<br>  can be rewritten to:<br>  SELECT <em><br>  FROM Customers<br>  WHERE ID IN (<br>      SELECT CustomerID<br>      FROM Orders<br>  )<br>  or with a join:<br>  SELECT Customers.</em><br>  FROM Customers<br>      INNER JOIN Orders ON Customers.ID = Orders.CustomerID<br>  Distinct and groupby take different execution plans<br>  SELECT DISTINCT business_key FROM memory WHERE<br>     concept &lt;&gt; ‘case’ or<br>     attrib &lt;&gt; ‘status’ or<br>     value &lt;&gt; ‘closed’<br>  It takes around 90 seconds<br>  SELECT business_key FROM memory WHERE<br>         concept &lt;&gt; ‘case’ or<br>         attrib &lt;&gt; ‘status’ or<br>         value &lt;&gt; ‘closed’<br>  GROUP BY business_key<br>  And it takes 1 second<br>  Reasons ：<br>  Distinct is executed like: copy all business_key to temporary table-&gt;sort temporary table-&gt;return different item that is different from the one before it<br>  Group by is executed like: scan full table, storing each value of business_key in a hash table -&gt; return the keys of the hash table<br>  *About hash table:<br>​<br>​            </p>
<p>The difference between TRUNCATE, DELETE and DROP?<br>(SOURCE: <a href="http://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands" target="_blank" rel="noopener">http://www.orafaq.com/faq/difference_between_truncate_delete_and_drop_commands</a>)<br>DELETE: Is used to remove rows from a table. A where clause can be used to only remove special rows, or all rows will be removed. You need to COMMIT or ROLLBACK the transaction to undo it.<br>TRUNCATE: removes all rows from a table. Cannot be rolled back and no triggers will be fired<br>DROP: removes a table from the database. No DML triggers will be fired.<br>DROP and TRUNCATE are DDL commands, whereas DELETE is a DML command. Therefore DELETE operations can be rolled back</p>
<p>DDL. DML, DCL and TCL<br>(SOURCE: <a href="http://www.cnblogs.com/henryhappier/archive/2010/07/05/1771295.html" target="_blank" rel="noopener">http://www.cnblogs.com/henryhappier/archive/2010/07/05/1771295.html</a>)<br>1.DDL（Data Definition Language）数据库定义语言statements are used to define the database structure or schema.<br>DDL是SQL语言的四大功能之一。<br>用于定义数据库的三级结构，包括外模式、概念模式、内模式及其相互之间的映像，定义数据的完整性、安全控制等约束<br>DDL不需要commit.<br>CREATE<br>ALTER<br>DROP<br>TRUNCATE<br>COMMENT<br>RENAME</p>
<p>2.DML（Data Manipulation Language）数据操纵语言statements are used for managing data within schema objects.<br>由DBMS提供，用于让用户或程序员使用，实现对数据库中数据的操作。<br>DML分成交互型DML和嵌入型DML两类。<br>依据语言的级别，DML又可分成过程性DML和非过程性DML两种。<br>需要commit.<br>SELECT<br>INSERT<br>UPDATE<br>DELETE<br>MERGE<br>CALL<br>EXPLAIN PLAN<br>LOCK TABLE</p>
<p>3.DCL（Data Control Language）数据库控制语言  授权，角色控制等<br>GRANT 授权<br>REVOKE 取消授权</p>
<p>4.TCL（Transaction Control Language）事务控制语言<br>SAVEPOINT 设置保存点<br>ROLLBACK  回滚<br>SET TRANSACTION</p>
<p>SQL主要分成四部分：<br>（1）数据定义。（SQL DDL）用于定义SQL模式、基本表、视图和索引的创建和撤消操作。<br>（2）数据操纵。（SQL DML）数据操纵分成数据查询和数据更新两类。数据更新又分成插入、删除、和修改三种操作。<br>（3）数据控制。包括对基本表和视图的授权，完整性规则的描述，事务控制等内容。<br>（4）嵌入式SQL的使用规定。涉及到SQL语句嵌入在宿主语言程序中使用的规则。</p>
<p>Using or on?<br>ON is the more general of the two. One can join tables ON a column, a set of columns and even a condition. For example:<br>SELECT * FROM world.City JOIN world.Country ON (City.CountryCode = Country.Code) WHERE …<br>USING is useful when both tables share a column of the exact same name on which they join. In this case, one may say:<br>SELECT … FROM film JOIN film_actor USING (film_id) WHERE …</p>
<p>Query Optimization Methods</p>
<ol>
<li>Use slow query log in mysql to locate the real problems<br>a. Set global slow_query_log = ‘ON’<br>b. Set global slow.query_log_file = ‘/var/log/mysql/slow-query.log’;<br>c. set global long_query_time = ‘20’;<br>d. [confirm]show variables like ‘%slow%’;</li>
<li>Use EXPLAIN and PROFILE to analyze your queries and detect potential issues:<br>a. EXPLAIN SELECT * FROM <code>user</code>;<br>b. Tee out.txt<br>c. Mysql \T “out.txt”<br> Examples:<br> select<br>  distinct cert.emp_id<br>from<br>  cm_log cl<br>inner join<br>  (<br> select<pre><code>emp.id as emp_id,
emp_cert.id as cert_id 
</code></pre> from<pre><code>employee emp 
</code></pre> left join<pre><code>emp_certificate emp_cert 
   on emp.id = emp_cert.emp_id 
</code></pre> where<pre><code>emp.is_deleted=0
</code></pre>  ) cert<br> on (<pre><code>cl.ref_table=&apos;Employee&apos; 
and cl.ref_oid= cert.emp_id
</code></pre> )<br> or (<pre><code>cl.ref_table=&apos;EmpCertificate&apos; 
and cl.ref_oid= cert.cert_id
</code></pre> )<br>where<br>  cl.last_upd_date &gt;=’2013-11-07 15:03:00’<br>  and cl.last_upd_date&lt;=’2013-11-08 16:00:00’;<br> 0.先运行一下，53条记录 1.87秒，又没有用聚合语句，比较慢<br> 53 rows in set (1.87 sec)</li>
<li>Use index to optimize the speed of querying:<br> (Source: <a href="http://tech.meituan.com/mysql-index.html" target="_blank" rel="noopener">http://tech.meituan.com/mysql-index.html</a> )<br>a. Index should be special, like count(distinct col)/count(<em>)<br>b. Index should not be calculated<br>c. Index should be more extended , not created<br>Examples:<br>select </em> from task where status = 0 and type = 12 limit 10;<br>select count(*) from task where status = 0 ;</li>
</ol>
<p>ON DUPLICATE KEY UPDATE: (MySQL special)<br> if you specify the ON DUPLICATE KEY UPDATE option in the INSERT statement, MySQL will insert a new row or update the existing row with the new values.<br>INSERT INTO sample_table(column_1)  The statement above sets the  value of the column_1 to its current value specified by the expression VALUES(column_1) + 1 if there is a duplicate in UNIQUE or PRIMARY KEY.<br>VALUES(column_1)<br>ON DUPLICATE KEY UPDATE column_1 = VALUES(column_1) + 1;<br>INSERT INTO table(a,b,c) VALUES(1,2,3)<br>ON DUPLICATE KEY UPDATE c=c+1;<br>Equals to<br>UPDATE TABLE SET c=c+1 WHERE a=1;</p>
<p>The difference between MODIFY COLUMN, CHANGE COLUMN:<br>Source: <a href="http://stackoverflow.com/questions/14767174/modify-column-vs-change-column" target="_blank" rel="noopener">http://stackoverflow.com/questions/14767174/modify-column-vs-change-column</a><br>MODIFY COLUN does everython CHANGE COLUMN can, but without renaming the column. 修改字段的时候使用CHANGE， 而修改字段类型时候使用MODIFY</p>
<p>PRIMARY KEY vs. UNIQUE KEY vs. KEY vs. FOREIGN KEY<br>• A KEY is a synonym for INDEX. You can use KEY is you want to create an index.<br>• A UNIQUE index creates a constraint for a column whose value must be unique, allow NULLL, can have multiple UNIQUE index: For example, the email and username of a user in the users table must be unique</p>
<p>Disable Foreign key checks:<br>SET foreign_key-checks = 0// to disable foreign key checks.<br>SET foreign_key-checks = 1</p>
<p>SQL Programming Style:<br>  • Use descriptive language to name your column<br>  • Column name start with characters.<br>    ◊ id 标识符——user_id 用户标识 item_id 商品标识<br>    ◊ dt 表示某个事件发生的时间——ord_dt 订单时间 exam_dt 考试时间<br>    ◊ num 表示某事相关的数字——sale_num 销量<br>    ◊ name 用字母表示名称——stu_name 学生名 等</p>
<p>  • Use Tab to make queries in a line.  Online SQL Formatter<br>   SELECT name, id, sex<br>    FROM (SELECT *<br>            FROM school_score<br>           WHERE class_cd = 110)<br>   WHERE sex = “男”<br>     AND exam_dt = “2016-06-01”;</p>
<p>  • Use BETWEEN instead of AND<br>  • Use IN instead of OR<br>  • Use CASE to handle complex queries<br>  • Use UNION<br>  SELECT CASE postcode<br>         WHEN ‘BN1’ THEN ‘Brighton’<br>         WHEN ‘EH1’ THEN ‘Edinburgh’<br>         END AS city<br>    FROM office_locations<br>   WHERE country = ‘United Kingdom’<br>     AND opening_time BETWEEN 8 AND 9<br>     AND postcode IN (‘EH1’, ‘BN1’, ‘NN1’, ‘KW1’);</p>
<p>  • 数据库的schema更新了之后，要立即能知道未来会执行的SQL语句有没有编译错误，不能等到运行的时候才发现。</p>
<h4 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h4><ul>
<li>SQL Practice Problems </li>
<li>Sams Teach Yourself SQL in 10 Minutes </li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8zMjEzMC84Njk0">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database/">Database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/">SQL</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/02/01/02012018-2301/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          给博客换模板 - From Jekyll To Hexo
        
      </div>
    </a>
  
  
    <a href="/2016/03/01/03012016-1651/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Robust and Optimal Stochastic Resource Allocation on Transportation Networks Subject to Disruptive Events</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Syntax"><span class="nav-number">1.</span> <span class="nav-text">SQL Syntax</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#‘Shipped’"><span class="nav-number"></span> <span class="nav-text">  ‘Shipped’);</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WHERE-conditions-ORDER-BY-…-LIMIT-rows"><span class="nav-number"></span> <span class="nav-text">  [WHERE conditions] [ORDER BY …] [LIMIT rows]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WHERE-conditions"><span class="nav-number"></span> <span class="nav-text">  [WHERE conditions]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Now-you-can-delete-records-associated-with-officeCode-5-from-both-offices-and-employees-tables"><span class="nav-number"></span> <span class="nav-text">  //Now, you can delete records associated with officeCode 5 from both offices and employees tables:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SET-column"><span class="nav-number"></span> <span class="nav-text">  SET column</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#References"><span class="nav-number">1.</span> <span class="nav-text">References:</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2014 - 2018 Qing&#39;s Journey All Rights Reserved.</p>
	      
	      
  		   	<p id="copyRightCn">Qing Wei hold copyright</p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>














  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Qing&#39;s Journey
          </div>
          <div class="panel-body">
            Copyright © 2018 Qing Wei All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>